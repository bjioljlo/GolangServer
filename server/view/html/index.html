<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.87.0">
    <title>Dashboard Template · Bootstrap v5.1</title>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin= "anonymous"></script>
    <!--<link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/dashboard/">
    <link rel="stylesheet" href="/assets/css/bootstrap-table.css">
    <link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin= "anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
    
    <script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table-locale-all.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/export/bootstrap-table-export.min.js"></script>-->
    
    
    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="../assets/css/dashboard.css" rel="stylesheet">
  </head>
  <body>
    
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">{{.session}}</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <input class="form-control form-control-dark w-50" type="text" placeholder="Search" aria-label="Search" id="stockname">
  <div class="navbar-nav">
    <div class="nav-item text-nowrap dropdown">
      <a class="nav-link px-5 dropdown-toggle" data-bs-toggle="dropdown" id="searchtext" href="">
      Actions</a>
      <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="searchtext">
        <li><a class="dropdown-item" onclick = "processFormData()" href="#">Search</a></li>
        <li><a class="dropdown-item" href="#" onclick = "saveTtock()" >加入{{.session}}的關注表</a></li>
        <li><a class="dropdown-item" href="#" onclick = "deletTtock()" >從{{.session}}的關注表刪除</a></li>
      </ul>
    </div>
  </div>
</header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="login">
              <span data-feather="users"></span>
              Account page
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/stock?stock={{.save_number1}}">
              <span data-feather="file"></span>
              {{.save_number1}}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/stock?stock={{.save_number2}}">
              <span data-feather="shopping-cart"></span>
              {{.save_number2}}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/stock?stock={{.save_number3}}">
              <span data-feather="home"></span>
              {{.save_number3}}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/stock?stock={{.save_number4}}">
              <span data-feather="bar-chart-2"></span>
              {{.save_number4}}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/stock?stock={{.save_number5}}">
              <span data-feather="layers"></span>
              {{.save_number5}}
            </a>
          </li>
        </ul>

        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>{{.session}}的關注表</span>
          <a class="link-secondary" href="#" aria-label="Add a new report">
            <span data-feather="plus-circle"></span>
          </a>
        </h6>
        <ul class="nav flex-column mb-2" id = "body2">
          <!--<li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Current month
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Last quarter
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Social engagement
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Year-end sale
            </a>
          </li>-->
        </ul>
        <script>
          const request3 = new XMLHttpRequest();
          var json3
          request3.onload = function () {
            if (request3.status >= 200 && request3.status < 400) {
              json3 = JSON.parse(request3.responseText)
              console.log(json3);
              let outside = document.createElement('ul');
              outside.className = "nav flex-column mb-2";
              for(i = 1;i <= Object.keys(json3).length ;i ++)
              {
                let row_1 = document.createElement('li');
                row_1.className = "nav-item";
                let heading_1 = document.createElement('a');
                heading_1.className = "nav-link";
                heading_1.href = "/stock?stock="+json3["save_number" + i];
                let heading_2 = document.createElement('span');
                heading_2.setAttribute("data-feather","file-text");
                
                heading_1.appendChild(heading_2);
                heading_1.append(json3["save_number" + i]);

                // let heading_3 = document.createElement('button');
                // heading_3.onclick = "deletTtock(this)"
                // heading_3.className = "btn-sm btn-outline-secondary"
                // let text = document.createTextNode("Delet");
                // heading_3.appendChild(text);
                // heading_1.appendChild(heading_3);

                row_1.appendChild(heading_1);
                document.getElementById('body2').appendChild(row_1);
              }
              
            }else {
            console.log('err');// 如果不是就印出錯誤
            }
          }
          request3.onerror = function () {
            console.log('error')
          } // 接下來也可以寫個新的 listener 叫做 onerror
          request3.open('GET', '/Sdata', false)
            // open 就是發一個 request
            // 括號內部就是發一個 GET 到 Google。
            // 第三個參數則是要不要非同步。非同步是 true 
          request3.send() // 要用這個才會真的把資料送出去
        </script>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Rate of return till today[%]</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
            <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
          </div>
          <button type="button" id="btnGroupDrop1" class="dropdown btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <span data-feather="calendar"></span>
            SearchHistory
          </button>
          <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
            <li><a class="dropdown-item" href="#">{{.session}} 的關注表</a></li>
            <li><a class="dropdown-item" href="#">Search排行</a></li>
          </ul>

        </div>
      </div>
      
      <canvas class="my-4 w-100" id="myChart" width="900" height="380">
      </canvas>

      <script>
      const request2 = new XMLHttpRequest();
      var json2
      request2.onload = function () {
        if (request2.status >= 200 && request2.status < 400) {
            // 這邊表示是有成功讀取網頁
            //console.log(request.responseText);
          json2 = JSON.parse(request2.responseText)
          console.log(json2);
            let numbers = [];
            let returns = [];
            for(i=0;i<Object.keys(json2).length/2;i++){
              numbers.push(json2["save_number" + (i+1)]);
              returns.push(json2["save_number" + (i+1) + "Return"]);
            }
            feather.replace({ 'aria-hidden': 'true' })

            // Graphs
            var ctx = document.getElementById('myChart')
            // eslint-disable-next-line no-unused-vars
            var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: numbers,
                datasets: [{
                  data: returns,
                  lineTension: 0,
                  backgroundColor: 'rgba(255, 99, 132, 0.2)',
                  borderColor: 'rgba(255,99,132,1)',
                  borderWidth: 4,
                  pointBackgroundColor: 'rgba(255, 99, 132, 0.2)'
                }]
              },
              options: {
                scales: {
                  yAxes: [{
                    ticks: {
                      beginAtZero: false
                    }
                  }]
                },
                legend: {
                  display: false
                }
              }
            })

          }else {
            console.log('err');// 如果不是就印出錯誤
          }
      }
      request2.onerror = function () {
        console.log('error')
      } // 接下來也可以寫個新的 listener 叫做 onerror
      request2.open('GET', '/Bdata', true)
        // open 就是發一個 request
        // 括號內部就是發一個 GET 到 Google。
        // 第三個參數則是要不要非同步。非同步是 true 
      request2.send() // 要用這個才會真的把資料送出去
      
      </script>

      <h2>Tomorrow Action</h2>
      <div class="table-responsive">
      {{.Data}}
      <table class="table table-striped table-sm" >
          <thead>
            <tr>
              <th scope="col">Number</th>
              <th scope="col">Date</th>
              <th scope="col">UnitNumber</th>
              <th scope="col">成本價格</th>
              <th scope="col">停損價格</th>
              <th scope="col">買入賣出</th>
              <th scope="col">多空單</th>
            </tr>
          </thead>
          <tbody id = "body">
            <script>
              const request = new XMLHttpRequest();
              var json
              request.onload = function () {
                if (request.status >= 200 && request.status < 400) {
                  // 這邊表示是有成功讀取網頁
                  //console.log(request.responseText);
                  json = JSON.parse(request.responseText)
                  console.log(json);
                  // Creating and adding data to first row of the table
                  for(i = 1;i < 6;i ++)
                  {
                    let row_1 = document.createElement('tr');
                    let heading_1 = document.createElement('td');
                    heading_1.innerHTML = json["save_number" + i];
                    let heading_2 = document.createElement('td');
                    heading_2.innerHTML = json["save_number"+i+"_Date"];
                    let heading_3 = document.createElement('td');
                    heading_3.innerHTML = json["save_number"+i+"_UnitNumber"];
                    let heading_4 = document.createElement('td');
                    heading_4.innerHTML = json["save_number"+i+"_BuyPrice"];
                    let heading_5 = document.createElement('td');
                    heading_5.innerHTML = json["save_number"+i+"_SellPrice"];
                    let heading_6 = document.createElement('td');
                    heading_6.innerHTML = json["save_number"+i+"_Buy_sell"];
                    let heading_7 = document.createElement('td');
                    if (parseFloat(json["save_number"+i+"_BuyPrice"]) > parseFloat(json["save_number"+i+"_SellPrice"]))
                    {
                      heading_7.innerHTML = "多單"
                    }
                    else{
                      heading_7.innerHTML = "空單"
                    }
                    
                    row_1.appendChild(heading_1);
                    row_1.appendChild(heading_2);
                    row_1.appendChild(heading_3);
                    row_1.appendChild(heading_4);
                    row_1.appendChild(heading_5);
                    row_1.appendChild(heading_6);
                    row_1.appendChild(heading_7);
                    document.getElementById('body').appendChild(row_1);
                  }
                } else {
                  console.log('err');// 如果不是就印出錯誤
                }
              }
              request.onerror = function () {
                console.log('error')
              } // 接下來也可以寫個新的 listener 叫做 onerror
              request.open('GET', '/Tdata', true)
              // open 就是發一個 request
              // 括號內部就是發一個 GET 到 Google。
              // 第三個參數則是要不要非同步。非同步是 true 
              request.send() // 要用這個才會真的把資料送出去
            </script>
          </tbody>
        </table>
      </div>
    </main>
  </div>
</div>
  <script type = "text/javascript">
    function processFormData() {
      var Element = document.getElementById("stockname");
      var name = Element.value;
      $.ajax({
         //告訴程式表單要傳送到哪裡                                         
        url:"/search",                                                              
        //需要傳送的資料
        data:"&stock="+name,  
         //使用POST方法     
        type : "GET",                                                                    
        //接收回傳資料的格式，在這個例子中，只要是接收true就可以了
        dataType:'json', 
         //傳送失敗則跳出失敗訊息      
        error:function(){                                                                 
        //資料傳送失敗後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        alert("失敗");
        },
        //傳送成功則跳出成功訊息
        success:function(){                                                           
        //資料傳送成功後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        //alert("成功");
        location.href = '/stock?stock=' + name;
        }
      });
      // console.log("processFormData " + name);
      // a.href = 'http://localhost:5000/stock/num1='+name+'&num2='+500000;
    }
    function saveTtock() {
      var Element = document.getElementById("stockname");
      var name = Element.value;
      $.ajax({
         //告訴程式表單要傳送到哪裡                                         
        url:"/save",                                                              
        //需要傳送的資料
        data:"&stock="+name,  
         //使用POST方法     
        type : "GET",                                                                    
        //接收回傳資料的格式，在這個例子中，只要是接收true就可以了
        dataType:'json', 
         //傳送失敗則跳出失敗訊息      
        error:function(){                                                                 
        //資料傳送失敗後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        alert("失敗");
        },
        //傳送成功則跳出成功訊息
        success:function(){                                                           
        //資料傳送成功後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        //alert("成功");
        location.reload();
        }
      });
    }
    function deletTtock(){
      var Element = document.getElementById("stockname");
      var name = Element.value;
      $.ajax({
         //告訴程式表單要傳送到哪裡                                         
        url:"/delet",                                                              
        //需要傳送的資料
        data:"&stock="+name,  
         //使用POST方法     
        type : "GET",                                                                    
        //接收回傳資料的格式，在這個例子中，只要是接收true就可以了
        dataType:'json', 
         //傳送失敗則跳出失敗訊息      
        error:function(){                                                                 
        //資料傳送失敗後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        alert("失敗");
        },
        //傳送成功則跳出成功訊息
        success:function(){                                                           
        //資料傳送成功後就會執行這個function內的程式，可以在這裡寫入要執行的程式  
        //alert("成功");
        location.reload();
        }
      });
    }
    </script>
  
  </body>
</html>
